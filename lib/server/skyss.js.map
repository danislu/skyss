{"version":3,"sources":["server/skyss.js"],"names":[],"mappings":";;;;;QAkBgB;QA2BA;;;;AA3ChB,SAAS,cAAT,CAAwB,IAAxB,EAA6B;QAClB,IAAO,KAAP,EADkB;QAChB,IAAK,KAAL,EADgB;;AAEzB,QAAM,UAAU,GAAV,CAFmB;AAGzB,QAAM,4DAAmD,YAAO,kBAAa,OAAvE,CAHmB;;AAKzB,WAAO,yBAAa,GAAb,EAAkB,UAAC,MAAD,EAAS,OAAT,EAAqB;;AAE1C,YAAI,QAAQ,EAAR,CAFsC;AAG1C,YAAI,OAAO,MAAP,IAAiB,OAAO,MAAP,CAAc,KAAd,IAAuB,OAAO,MAAP,CAAc,KAAd,CAAoB,MAApB,GAA6B,CAA7B,EAA+B;AACvE,oBAAQ,OAAO,MAAP,CAAc,KAAd,CAAoB,CAApB,EAAuB,CAAvB,CAAyB,CAAzB,CAD+D;SAA3E;;AAIA,gBAAQ,KAAR,EAP0C;KAArB,CAAzB,CALyB;CAA7B;;AAgBO,SAAS,kCAAT,CAA4C,UAA5C,EAAwD,EAAxD,EAA2D;AAC9D,WAAO,eAAe,UAAf,EAA2B,IAA3B,CAAgC,UAAC,KAAD,EAAW;AAC9C,YAAM,yDAAgD,iBAAY,iBAA5D,CADwC;;AAG9C,eAAO,yBAAa,GAAb,EAAkB,UAAC,MAAD,EAAS,OAAT,EAAqB;AAC1C,gBAAM,QAAQ,OAAO,MAAP,CAAc,KAAd,CAAoB,CAApB,EAAuB,IAAvB,CAD4B;AAE1C,gBAAM,OAAO,MAAM,GAAN,CAAU,UAAC,IAAD,EAAU;kCACI,KAAK,CAAL,CAAO,CAAP,EAAU,CAAV,CADJ;oBACrB,kBADqB;oBAClB,oBADkB;oBACd,oBADc;oBACV,kBADU;oBACP,oBADO;oBACH,oBADG;;AAE7B,uBAAO;AACH,0BAAM,KAAK,CAAL;AACN,2BAAO;AACH,8BAAM,CAAN;AACA,4BAAI,EAAJ;AACA,mCAAW,EAAX;AACA,iCAAS,CAAT;AACA,8BAAM,EAAN;AACA,qCAAa,EAAb;qBANJ;iBAFJ,CAF6B;aAAV,CAAV,CAaV,MAbU,CAaH;uBAAK,EAAE,KAAF,CAAQ,IAAR,IAAgB,OAAhB;aAAL,CAbJ,CAFoC;;AAiB1C,oBAAQ,IAAR,EAjB0C;SAArB,CAAzB,CAH8C;KAAX,CAAvC,CAD8D;CAA3D;;AA2BA,SAAS,cAAT,CAAwB,MAAxB,EAA+B;AAClC,QAAM,6DAAoD,kBAApD,CAD4B;;AAGlC,WAAO,yBAAa,GAAb,EAAkB,UAAC,MAAD,EAAS,OAAT,EAAqB;AAC1C,gBAAQ,OAAO,MAAP,CAAc,CAAd,CAAgB,GAAhB,CAAoB,UAAC,CAAD;mBAAM,EAAE,CAAF,CAAI,CAAJ;SAAN,CAA5B,EAD0C;KAArB,CAAzB;;;AAHkC,CAA/B","file":"server/skyss.js","sourcesContent":["import { baseTravelMagicUrl, getXmlToJson } from './utils';\n\nfunction getNearestStop(from){\n    const {x,y} = from;\n    const maxdist = 250;\n    const url = `${baseTravelMagicUrl}/v1NearestStopsXML?y=${y}&x=${x}&maxdist=${maxdist}`;\n\n    return getXmlToJson(url, (result, resolve) => {\n\n        let value = '';\n        if (result.stages && result.stages.group && result.stages.group.length > 0){\n            value = result.stages.group[0].$.n;\n        }\n\n        resolve(value);\n    });\n}\n\nexport function getNextDeparturesFromGeoToLocation(fromCoords, to){\n    return getNearestStop(fromCoords).then((value) => {\n        const url = `${baseTravelMagicUrl}/v1SearchXML?From=${value}&to=${to}&instant=1`;\n\n        return getXmlToJson(url, (result, resolve) => {\n            const trips = result.result.trips[0].trip;\n            const deps = trips.map((trip) => {\n                const { n, n2, nd, l, tn, td } = trip.i[0].$;\n                return {\n                    trip: trip.$,\n                    first: {\n                        from: n,\n                        to: n2,\n                        line_name: nd,\n                        line_no: l,\n                        kind: tn,\n                        travel_time: td\n                    }\n                };\n            }).filter(d => d.first.kind != 'Gange');\n\n            resolve(deps);\n        });\n    });\n}\n\n\nexport function getSuggestions(filter){\n    const url = `${baseTravelMagicUrl}/v2LocationXML?filter=${filter}&type=1`;\n\n    return getXmlToJson(url, (result, resolve) => {\n        resolve(result.stages.i.map((i)=> i.$.n));\n    });\n\n    //http://reiseplanlegger.skyss.no/scripts/travelmagic/TravelMagicWE.dll//v2LocationXML?filter=Danmarks plass&type=1\n}\n"],"sourceRoot":"/source/"}