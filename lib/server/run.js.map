{"version":3,"sources":["server/run.js"],"names":[],"mappings":"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","file":"server/run.js","sourcesContent":["import { getDepartures, getNextDeparture, HOLDEPLASSER, getNextDeparturesFromGeoToLocation, getSuggestions } from './index';\nimport express from 'express';\nvar app = express();\n\nconst port = 8181;\n\nconst log = (msg) => {\n    console.log(`${new Date()}: ${msg}`);\n};\n\nconst doQuery = (req, res, fn) =>{\n    const from = req.query.from;\n    const to = req.query.to;\n\n    log(`req: ${from} -> ${to}`);\n\n    if (!HOLDEPLASSER.hasOwnProperty(from)){\n        const msg = `res: 404 destination ${from} not not found`;\n        log(msg);\n        res.status(404).end(msg);\n        return;\n    }\n    if (!HOLDEPLASSER.hasOwnProperty(to)){\n        const msg = `res: 404 destination ${to} not found`;\n        log(msg);\n        res.status(404).end(msg);\n        return;\n    }\n\n    fn({from: HOLDEPLASSER[from], to: HOLDEPLASSER[to]}).then((data) => {\n        log(`res: 200 ${JSON.stringify(data)}`);\n        res.json(data);\n    }).catch((e) => {\n        log(`res: 500 ${JSON.stringify(e)}`);\n        res.status(500).json(e);\n    });\n};\n\napp.get('/next', (req, res) => {\n    doQuery(req, res, getNextDeparture);\n});\n\napp.get('/departures', (req, res) => {\n    doQuery(req, res, getDepartures);\n});\n\napp.get('/destinations', (req, res) => {\n    log('destinations fetched');\n    res.json(Object.keys(HOLDEPLASSER));\n});\n\napp.get('/', (req, res) => {\n    log('service document fetched');\n    res.json({\n        departues: {\n            endpoint: '/departures2?from_x=<x-coord>&from_y=<y-coord>&to=<destination>',\n            description: 'get the next 10 departues from the nearest stop to the given position to the given destination.',\n            parameters: [\n                {\n                    name: 'from_x',\n                    description: 'x coordinates'\n                },\n                {\n                    name: 'from_y',\n                    description: 'y coordinates'\n                },\n                {\n                    name: 'to',\n                    format: '*',\n                    description: 'a stop name'\n                }\n            ]\n\n        },\n        stop_suggest: {\n            suggest: '/suggest?filter=<filter>',\n            description: 'get the suggested stops based on the filter'\n        }\n    });\n});\n\n\napp.get('/departures2', (req, res) => {\n    const { from_x, from_y, to } = req.query;\n\n    try{\n        if ((from_x < 0) || (from_y < 0 ) || (!to))\n            throw { error: 'invalid input'};\n\n        getNextDeparturesFromGeoToLocation({x: from_x, y: from_y}, to)\n            .then((value)=>{\n                res.json(value);\n            }).catch((e)=>{\n                res.status(500).json(e);\n            });\n\n    } catch(e) {\n        console.log(e);\n        res.status(405).json(e);\n        return;\n    }\n});\n\napp.get('/suggest', (req, res) => {\n    const { filter } = req.query;\n    getSuggestions(filter).then(value => res.json(value)).catch(e => res.status(500).json(e));\n});\n\napp.listen(port);\nconsole.log(`listening to port ${port}`);\n"],"sourceRoot":"/source/"}